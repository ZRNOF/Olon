var t=class{constructor(t=300,e=150,i=!1){this.frame=0,this.seconds=0,this.startTime=0,this.currentTime=performance.now(),this.lastFrameTime=performance.now(),this.fps=60,this.oMouseX=0,this.oMouseY=0,this.mouseX=0,this.mouseY=0,this.isLooping=!0,this.bufferList={},this.ATTACH_TO_2D=i,this.canvas2D=null,this.o2D=null,this._initCanvas2D(t,e),this.canvas=null,this.gl=null,this._initCanvas(t,e),this._enableCanvas2D(),this.program=null,this.canvas.addEventListener("mousemove",(t=>this._mouseMove(t,this.canvas))),this.canvas.addEventListener("touchmove",(t=>this._touchMove(t,this.canvas)))}sketch(){const{positionData:t,texCoordData:e}=this.sketchData();this.setAttribute("aPosition",t,"f32",2),this.setAttribute("aTexCoord",e,"f32",2)}fullscreen(){const{left:t,top:e}=this._getBorderSize(this.canvas);this.width=window.innerWidth-2*t,this.height=window.innerHeight-2*e,window.addEventListener("resize",(()=>{const{left:t,top:e}=this._getBorderSize(this.canvas);this.width=window.innerWidth-2*t,this.height=window.innerHeight-2*e}))}_initCanvas(t,e){this.canvas=document.createElement("canvas"),[this.canvas.width,this.canvas.height]=[t,e],this.canvas.id="olon-canvas",document.body.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl2"),this.canvas.style.display="block"}_initCanvas2D(t,e){this.ATTACH_TO_2D&&(this.canvas2D=document.createElement("canvas"),[this.canvas2D.width,this.canvas2D.height]=[t,e],this.canvas2D.id="o2d",document.body.appendChild(this.canvas2D),this.o2D=this.canvas2D.getContext("2d"),this.canvas2D.style.display="none")}_enableCanvas2D(){this.ATTACH_TO_2D&&(this.canvas.style.display="none",this.canvas2D.style.display="block",this.canvas2D.addEventListener("mousemove",(t=>this._mouseMove(t,this.canvas2D))),this.canvas2D.addEventListener("touchmove",(t=>this._touchMove(t,this.canvas2D))))}render(t){const e=i=>{this.frame++,this.timestamp=i,this.currentTime=performance.now(),this.seconds=(this.currentTime-this.startTime)/1e3,this.fps=1e3/(this.currentTime-this.lastFrameTime),t(),this.canvas2D&&this.o2D.drawImage(this.canvas,0,0),this.lastFrameTime=this.currentTime,this.isLooping&&requestAnimationFrame(e)};this.pause=()=>this.isLooping=!1,this.play=()=>{this.isLooping=!0,requestAnimationFrame(e)},this.toggle=()=>{this.isLooping=!this.isLooping,this.isLooping&&requestAnimationFrame(e)},this.startTime=performance.now(),requestAnimationFrame(e)}use({program:t=null,VAO:e=null,FBO:i=null,RBO:r=null,texture2D:o=null,buffer:s=null,Depth:n=!1,Blend:a=!1}={program:t,VAO:e,FBO:i,RBO:r,texture2D:o,Depth:n,Blend:a}){return{run:h=>{t&&this.useProgram(t),e&&this.bindVAO(e),i&&this.bindFBO(i),r&&this.bindRBO(r),o&&this.bindTexture2D(o),s&&this.bindBuffer(s),n&&this.enableDepth(),a&&this.enableBlend(),h(),a&&this.disableBlend(),n&&this.disableDepth(),s&&this.unbindBuffer(),o&&this.unbindTexture2D(),r&&this.unbindRBO(),i&&this.unbindFBO(),e&&this.unbindVAO()}}}get oMouse(){return[this.oMouseX,this.oMouseY]}get mouse(){return[this.mouseX,this.mouseY]}get limit(){return{TOTAL_TEXTURES:this.MAX_TEXTURES,FRAG_TEXTURE:this.MAX_FRAG_TEXTURES,VERT_TEXTURE:this.MAX_VERT_TEXTURES,DRAW_BUFFERS:this.MAX_DRAW_BUFFERS}}get MAX_TEXTURES(){return this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)}get MAX_FRAG_TEXTURES(){return this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}get MAX_VERT_TEXTURES(){return this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}get width(){return this.canvas.width}get height(){return this.canvas.height}set width(t){this.canvas2D&&(this.canvas2D.width=t),this.canvas.width=t,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}set height(t){this.canvas2D&&(this.canvas2D.height=t),this.canvas.height=t,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}get resolution(){return[this.canvas.width,this.canvas.height]}};t.prototype.BLEND_MODE=32774,t.prototype.BLEND_SFAC=1,t.prototype.BLEND_DFAC=0,t.prototype.STATIC_DRAW=35044,t.prototype.DYNAMIC_DRAW=35048,t.prototype.STREAM_DRAW=35040,t.prototype.STATIC_READ=35045,t.prototype.DYNAMIC_READ=35049,t.prototype.STREAM_READ=35041,t.prototype.STATIC_COPY=35046,t.prototype.DYNAMIC_COPY=35050,t.prototype.STREAM_COPY=35042,t.prototype.COLOR_BUFF=16384,t.prototype.DEPTH_BUFF=256,t.prototype.STENCIL_BUFF=1024,t.prototype.POINTS=0,t.prototype.LINES=1,t.prototype.LINE_LOOP=2,t.prototype.LINE_STRIP=3,t.prototype.TRIANGLES=4,t.prototype.TRIANGLE_STRIP=5,t.prototype.TRIANGLE_FAN=6,t.prototype.REPEAT=10497,t.prototype.CLAMP=33071,t.prototype.MIRROR=33648,t.prototype.NEAREST=9728,t.prototype.LINEAR=9729,t.prototype.NMN=9984,t.prototype.LMN=9985,t.prototype.NML=9986,t.prototype.LML=9987,t.prototype.FB=36160,t.prototype.T2D=3553,t.prototype.RB=36161,t.prototype.DA=36096,t.prototype.AB=34962,t.prototype.ADD=32774,t.prototype.SUB=32778,t.prototype.REV_SUB=32779,t.prototype.MIN=32775,t.prototype.MAX=32776,t.prototype.FRONT=1028,t.prototype.BACK=1029,t.prototype.FRONT_AND_BACK=1032,t.prototype.ALL=1032,t.prototype.ZERO=0,t.prototype.ONE=1,t.prototype.SRC_COLOR=768,t.prototype.ONE_MINUS_SRC_COLOR=769,t.prototype.DST_COLOR=774,t.prototype.ONE_MINUS_DST_COLOR=775,t.prototype.SRC_ALPHA=770,t.prototype.ONE_MINUS_SRC_ALPHA=771,t.prototype.DST_ALPHA=772,t.prototype.ONE_MINUS_DST_ALPHA=773,t.prototype.CONSTANT_COLOR=32769,t.prototype.ONE_MINUS_CONSTANT_COLOR=32770,t.prototype.CONSTANT_ALPHA=32771,t.prototype.ONE_MINUS_CONSTANT_ALPHA=32772,t.prototype.SRC_ALPHA_SATURATE=776,t.prototype.RGB=6407,t.prototype.RGBA=6408,t.prototype.LUMINANCE_ALPHA=6410,t.prototype.LUMINANCE=6409,t.prototype.ALPHA=6406,t.prototype.R8=33321,t.prototype.R16F=33325,t.prototype.R32F=33326,t.prototype.R8UI=33330,t.prototype.RG8=33323,t.prototype.RG16F=33327,t.prototype.RG32F=33328,t.prototype.RG8UI=33336,t.prototype.RGB8=32849,t.prototype.SRGB8=35905,t.prototype.RGB565=36194,t.prototype.R11F_G11F_B10F=35898,t.prototype.RGB9_E5=35901,t.prototype.RGB16F=34843,t.prototype.RGB32F=34837,t.prototype.RGB8UI=36221,t.prototype.RGBA8=32856,t.prototype.SRGB8_ALPHA8=35907,t.prototype.RGB5_A1=32855,t.prototype.RGB10_A2=32857,t.prototype.RGBA4=32854,t.prototype.RGBA16F=34842,t.prototype.RGBA32F=34836,t.prototype.RGBA8UI=36220;t.prototype.UniformMap={5126:(t,e,i)=>t.uniform1f(e,i),35664:(t,e,i)=>t.uniform2fv(e,i),35665:(t,e,i)=>t.uniform3fv(e,i),35666:(t,e,i)=>t.uniform4fv(e,i),5124:(t,e,i)=>t.uniform1i(e,i),35667:(t,e,i)=>t.uniform2iv(e,i),35668:(t,e,i)=>t.uniform3iv(e,i),35669:(t,e,i)=>t.uniform4iv(e,i),35670:(t,e,i)=>t.uniform1i(e,i),35671:(t,e,i)=>t.uniform2iv(e,i),35672:(t,e,i)=>t.uniform3iv(e,i),35673:(t,e,i)=>t.uniform4iv(e,i),35674:(t,e,i)=>t.uniformMatrix2fv(e,!1,i),35675:(t,e,i)=>t.uniformMatrix3fv(e,!1,i),35676:(t,e,i)=>t.uniformMatrix4fv(e,!1,i),5125:(t,e,i)=>t.uniform1u(e,i),36294:(t,e,i)=>t.uniform2uv(e,i),36295:(t,e,i)=>t.uniform3uv(e,i),36296:(t,e,i)=>t.uniform4uv(e,i),35678:(t,e,i)=>t.uniform1i(e,i),35679:(t,e,i)=>t.uniform1i(e,i),35682:(t,e,i)=>t.uniform1i(e,i),36289:(t,e,i)=>t.uniform1i(e,i),36292:(t,e,i)=>t.uniform1i(e,i),36293:(t,e,i)=>t.uniform1i(e,i)},t.prototype.samplerTypes=new Set([35680,35678,35679,35682,36289,36292,36293]),t.prototype.UnitMap={i8:{size:1,type:5120},i16:{size:2,type:5122},i32:{size:4,type:5124},u8:{size:1,type:5121},u16:{size:2,type:5123},u32:{size:4,type:5125},f32:{size:4,type:5126}},t.prototype.TypeArrayUnit={Int8Array:"i8",Int16Array:"i16",Int32Array:"i32",Uint8Array:"u8",Uint16Array:"u16",Uint32Array:"u32",Float32Array:"f32"},t.prototype.DataMap={i8:Int8Array,i16:Int16Array,i32:Int32Array,u8:Uint8Array,u16:Uint16Array,u32:Uint32Array,f32:Float32Array},t.prototype.IFormatMap={6407:{format:6407,type:5121},6408:{format:6408,type:5121},6410:{format:6410,type:5121},6409:{format:6409,type:5121},6406:{format:6406,type:5121},33321:{format:6403,type:5121},33325:{format:6403,type:5126},33326:{format:6403,type:5126},33330:{format:36244,type:5121},33323:{format:33319,type:5121},33327:{format:33319,type:5126},33328:{format:33319,type:5126},33336:{format:33320,type:5121},32849:{format:6407,type:5121},35905:{format:6407,type:5121},36194:{format:6407,type:5121},35898:{format:6407,type:5126},35901:{format:6407,type:5126},34843:{format:6407,type:5126},34837:{format:6407,type:5126},36221:{format:36248,type:5121},32856:{format:6408,type:5121},35907:{format:6408,type:5121},32855:{format:6408,type:5121},32857:{format:6408,type:33640},32854:{format:6408,type:5121},34842:{format:6408,type:5126},34836:{format:6408,type:5126},36220:{format:36249,type:5121}};t.prototype.enableExtensions=function(t){const e=t.filter((t=>!this.gl.getExtension(t)));return 0===e.length||(console.warn("enableFloat: The following extensions are not supported:",e.join(", ")),e)},t.prototype.enableFloat=function(){this.enableExtensions(["EXT_color_buffer_float","OES_texture_float_linear"])};t.prototype._shader=function(t,e,i){const r=this.gl.createShader(i);/#version 300 es/.test(e)||(e=`#version 300 es\n${e}`),e=e.replace(/^\s+/,""),this.gl.shaderSource(r,e),this.gl.compileShader(r),this.gl.attachShader(t.program,r)},t.prototype._processShader=function(t,e,i){Array.isArray(e)?e.forEach((e=>this._shader(t,e,i))):this._shader(t,e,i)},t.prototype.setShader=function(t,e){this.program=this.createProgram(t,e),this.linkProgram(this.program),this.useProgram(this.program)};t.prototype.setProgram=function(t){this.program=t},t.prototype.linkProgram=function(t){this.setProgram(t),this.gl.linkProgram(t.program)},t.prototype.useProgram=function(t){this.setProgram(t),this.gl.useProgram(t.program)},t.prototype._updateProgramUniforms=function(t,e,i,r){t.uniforms[e]={type:i,size:r}},t.prototype.createProgram=function(t,e,i){const r={program:this.gl.createProgram(),uniforms:{},texUnitList:{},texUnitCount:0,emptyTexUnits:[]};this._processShader(r,t,this.gl.VERTEX_SHADER),this._processShader(r,e,this.gl.FRAGMENT_SHADER),i&&this.gl.transformFeedbackVaryings(r.program,i,this.gl.INTERLEAVED_ATTRIBS),this.linkProgram(r),this.useProgram(r);const o=this._getActiveUniforms(r);for(let t=0;t<o;++t){const{name:e,type:i,size:o}=this._getActiveUniform(r,t);this._updateProgramUniforms(r,e,i,o),this.samplerTypes.has(i)&&this._setTexUnit(e)}return r},t.prototype._setTexUnit=function(t){const e=this.program.emptyTexUnits.length?this.program.emptyTexUnits.pop():this.program.texUnitCount++;this.uniform(t,e),this.program.texUnitList[t]=e},t.prototype._getActiveUniform=function(t,e){const i=this.gl.getActiveUniform(t.program,e);return{name:i.name.replace(/\[[^\]]*\]/g,""),type:i.type,size:i.size}};t.prototype.createBuffer=function(t,e){const i=this.gl.createBuffer();return this.useBuffer(i,(()=>this.gl.bufferData(this.AB,t,e))),i},t.prototype.bindBuffer=function(t){this.gl.bindBuffer(this.AB,t)},t.prototype.unbindBuffer=function(){this.gl.bindBuffer(this.AB,null)},t.prototype.useBuffer=function(t,e){this.bindBuffer(t),e(),this.unbindBuffer()};t.prototype.drawArrays=function(t,e,i){this.gl.drawArrays(t,e,i)},t.prototype.points=function(t,e){this.gl.drawArrays(this.gl.POINTS,t,e)},t.prototype.lines=function(t,e){this.gl.drawArrays(this.gl.LINES,t,e)},t.prototype.lineLoop=function(t,e){this.gl.drawArrays(this.gl.LINE_LOOP,t,e)},t.prototype.lineStrip=function(t,e){this.gl.drawArrays(this.gl.LINE_STRIP,t,e)},t.prototype.triangles=function(t,e){this.gl.drawArrays(this.gl.TRIANGLES,t,e)},t.prototype.triangleStrip=function(t,e){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,t,e)},t.prototype.triangleFan=function(t,e){this.gl.drawArrays(this.gl.TRIANGLE_FAN,t,e)},t.prototype.drawArraysInstanced=function(t,e,i,r){this.gl.drawArraysInstanced(t,e,i,r)},t.prototype.pointsInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.POINTS,t,e,i)},t.prototype.linesInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.LINES,t,e,i)},t.prototype.lineLoopInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.LINE_LOOP,t,e,i)},t.prototype.lineStripInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.LINE_STRIP,t,e,i)},t.prototype.trianglesInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.TRIANGLES,t,e,i)},t.prototype.triangleStripInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.TRIANGLE_STRIP,t,e,i)},t.prototype.triangleFanInstanced=function(t,e,i){this.gl.drawArraysInstanced(this.gl.TRIANGLE_FAN,t,e,i)};t.prototype.aLoc=function(t){return this.gl.getAttribLocation(this.program.program,t)},t.prototype.uLoc=function(t){return this.gl.getUniformLocation(this.program.program,t)},t.prototype.oLoc=function(t){return this.gl.getFragDataLocation(this.program.program,t)};t.prototype.setAttribute=function(t,e,i,r,o){const s=this.aLoc(t),n=this.gl.createBuffer(),a=this.UnitMap[i].type;this.useBuffer(n,(()=>{this.gl.bufferData(this.AB,e,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(s,r,a,!1,0,0),this.gl.enableVertexAttribArray(s),Number.isInteger(o)&&o>=0&&this.gl.vertexAttribDivisor(s,o)}));const h={buffer:n,loc:s,name:t,data:e,size:r};return this.bufferList[t]=h,h};t.prototype._getActiveUniforms=function(t){return this.gl.getProgramParameter(t.program,this.gl.ACTIVE_UNIFORMS)},t.prototype.uniform=function(t,e,i){const r=this.program.uniforms[t];if(!r)return;if(Object.hasOwn(this.program.texUnitList,t)){if(i instanceof HTMLVideoElement){if(i.readyState!==i.HAVE_ENOUGH_DATA)return;const r=this.RGBA,{format:o,type:s}=this.IFormatMap[r];this.gl.activeTexture(this.gl.TEXTURE0+this.program.texUnitList[t]),this.gl.bindTexture(this.T2D,e),this.gl.texImage2D(this.T2D,0,r,o,s,i)}return this.gl.activeTexture(this.gl.TEXTURE0+this.program.texUnitList[t]),void this.gl.bindTexture(this.T2D,e)}const o=this.uLoc(t);this.UniformMap[r.type](this.gl,o,e)},t.prototype.initUniform=function(t){const e={},i=Object.entries(t);for(const[t,r]of i)e[t]=e=>this.uniform(r,t,e);return e};t.prototype._getBorderSize=function(t){const e=window.getComputedStyle(t);return{top:parseFloat(e.borderTopWidth)||0,left:parseFloat(e.borderLeftWidth)||0}},t.prototype._updateMouse=function(t,e,i){this.oMouseX=e/t.scrollWidth,this.oMouseY=i/t.scrollHeight,this.oMouseY=t.height-this.oMouseY,this.mouseX=this.oMouseX/this.width*2-1,this.mouseY=this.oMouseY/this.height*2-1},t.prototype._mouseMove=function(t,e){const i=t.offsetX*e.width,r=t.offsetY*e.height;this._updateMouse(e,i,r)},t.prototype._touchMove=function(t,e){t=t.touches?t.touches[0]:t.changedTouches?.[0];const i=e.getBoundingClientRect(),{left:r,top:o}=this._getBorderSize(e),s=(t.clientX-i.left-r)*e.width,n=(t.clientY-i.top-o)*e.height;this._updateMouse(e,s,n)};t.prototype.enableBlend=function(){this.gl.enable(this.gl.BLEND)},t.prototype.disableBlend=function(){this.gl.disable(this.gl.BLEND)},t.prototype.blend=function({sfactor:t=this.BLEND_SFAC,dfactor:e=this.BLEND_DFAC,mode:i=this.BLEND_MODE}={sfactor:t,dfactor:e,mode:i}){this.BLEND_SFAC=t,this.BLEND_DFAC=e,this.BLEND_MODE=i,this.gl.blendEquation(this.BLEND_MODE),this.gl.blendFunc(this.BLEND_SFAC,this.BLEND_DFAC)};t.prototype.enableDepth=function(){this.gl.enable(this.gl.DEPTH_TEST)},t.prototype.disableDepth=function(){this.gl.disable(this.gl.DEPTH_TEST)},t.prototype.useDepth=function(t){this.gl.enable(this.gl.DEPTH_TEST),t(),this.gl.disable(this.gl.DEPTH_TEST)};t.prototype.enableCulling=function(){this.gl.enable(this.gl.CULL_FACE)},t.prototype.disableCulling=function(){this.gl.disable(this.gl.CULL_FACE)},t.prototype.cull=function(t){this.gl.cullFace(t)};t.prototype.clear=function(t){this.gl.clear(t)},t.prototype.clearColor=function(t,e,i,r){0!==arguments.length&&this.gl.clearColor(t,e,i,r),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},t.prototype.clearDepth=function(t){0!==arguments.length&&this.gl.clearDepth(t),this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},t.prototype.clearStencil=function(t){0!==arguments.length&&this.gl.clearStencil(t),this.gl.clear(this.gl.STENCIL_BUFFER_BIT)};t.prototype._isDOMElement=function(t){return t instanceof HTMLElement},t.prototype.setTexParameter=function(t,e,i,r){this.gl.texParameteri(this.T2D,this.gl.TEXTURE_WRAP_S,t),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_WRAP_T,e),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_MIN_FILTER,i),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_MAG_FILTER,r)},t.prototype.bindTexture2D=function(t){this.gl.bindTexture(this.T2D,t)},t.prototype.unbindTexture2D=function(){this.gl.bindTexture(this.T2D,null)},t.prototype.useTexture2D=function(t,e){this.bindTexture2D(t),e(),this.unbindTexture2D()},t.prototype._emptyTexStorage2D=function({width:t=this.width,height:e=this.height,iformat:i,minFilter:r=this.LINEAR,magFilter:o=this.LINEAR,filter:s,wrapS:n=this.REPEAT,wrapT:a=this.REPEAT,wrap:h,flipY:p=!1}={}){if(!i)throw"_emptyTexStorage2D: Please specify iformat (internalformat).";s&&([r,o]=[s,s]),h&&([n,a]=[h,h]);const c=this.gl.createTexture();return this.useTexture2D(c,(()=>{this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,p),this.setTexParameter(n,a,r,o),this.gl.texStorage2D(this.T2D,1,i,t,e)})),c},t.prototype._emptyTexImage2D=function({width:t=this.width,height:e=this.height,iformat:i,minFilter:r=this.LINEAR,magFilter:o=this.LINEAR,filter:s,wrapS:n=this.REPEAT,wrapT:a=this.REPEAT,wrap:h,flipY:p=!1}={}){if(!i)throw"_emptyTexImage2D: Please specify iformat (internalformat).";s&&([r,o]=[s,s]),h&&([n,a]=[h,h]);const{format:c,type:l}=this.IFormatMap[i],u=this.gl.createTexture();return this.useTexture2D(u,(()=>{this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,p),this.setTexParameter(n,a,r,o),this.gl.texImage2D(this.T2D,0,i,t,e,0,c,l,null)})),u},t.prototype.texture2D=function({data:t=null,iformat:e,level:i=0,width:r=t?.width||this.width,height:o=t?.height||this.height,minFilter:s=this.LINEAR,magFilter:n=this.LINEAR,filter:a,wrapS:h=this.REPEAT,wrapT:p=this.REPEAT,wrap:c,flipY:l=this._isDOMElement(t),immutableStorage:u=!1}={}){if(!e)throw"texture2D: Please specify iformat (internalformat).";if(!t){const t={width:r,height:o,iformat:e,minFilter:s,magFilter:n,filter:a,wrapS:h,wrapT:p,wrap:c,flipY:l};return u?this._emptyTexStorage2D(t):this._emptyTexImage2D(t)}a&&([s,n]=[a,a]),c&&([h,p]=[c,c]);const{format:g,type:f}=this.IFormatMap[e],y=this.gl.createTexture();return this.gl.bindTexture(this.T2D,y),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,l),this.gl.texImage2D(this.T2D,i,e,r,o,0,g,f,t),this.gl.generateMipmap(this.T2D),this.setTexParameter(h,p,s,n),this.gl.bindTexture(this.T2D,null),y};t.prototype._calcStride=function(t){return t.reduce(((t,{unit:e,size:i})=>t+i*this.UnitMap[e].size),0)},t.prototype._vaoByBufferInfos=function(t,e){Array.isArray(e)||(e=[e]);const i=this.gl.createVertexArray();return this.use({program:this.useProgram(t),VAO:i}).run((()=>{e.forEach((t=>{this.useBuffer(t.buffer,(()=>{const e=t.attributes,i=t.stride||this._calcStride(e),r=t.divisor;let o=0;e.forEach((({name:t,unit:e,size:s})=>{const n=this.aLoc(t),a=this.UnitMap[e].type;this.gl.vertexAttribPointer(n,s,a,!1,i,o),this.gl.enableVertexAttribArray(n),o+=s*this.UnitMap[e].size,Number.isInteger(r)&&r>=0&&this.gl.vertexAttribDivisor(n,r)}))}))}))})),i},t.prototype._vaoByAttribute=function(t,e){this.useProgram(t);const i=this.gl.createVertexArray();return this.useVAO(i,(()=>{e.forEach((({name:t,data:e,size:i})=>{const r=this.TypeArrayUnit[e.constructor.name];this.setAttribute(t,e,r,i)}))})),i},t.prototype._checkUseAttribute=function(t){return Array.isArray(t)&&Object.hasOwn(t[0],"name")},t.prototype.createVAO=function(t,e){return this._checkUseAttribute(e)?this._vaoByAttribute(t,e):this._vaoByBufferInfos(t,e)},t.prototype.bindVAO=function(t){this.gl.bindVertexArray(t)},t.prototype.unbindVAO=function(){this.gl.bindVertexArray(null)},t.prototype.useVAO=function(t,e){this.bindVAO(t),e(),this.unbindVAO()};t.prototype.bindFBO=function(t){this.gl.bindFramebuffer(this.FB,t)},t.prototype.unbindFBO=function(){this.gl.bindFramebuffer(this.FB,null)},t.prototype.useFBO=function(t,e){this.bindFBO(t),e(),this.unbindFBO()},t.prototype.checkFramebufferStatus=function(){switch(this.gl.checkFramebufferStatus(this.FB)){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case this.gl.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_UNSUPPORTED"}},t.prototype.createFBO=function({program:t,outs:e,depthBuffer:i}){const r=this.gl.createFramebuffer();return this.useFBO(r,(()=>{const r=this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS),o=Array.from({length:r},(()=>this.gl.NONE));this.setProgram(t),e.forEach((({name:t,texture:e})=>{const i=this.oLoc(t),r=this.gl.COLOR_ATTACHMENT0+i;o[i]=r,this.gl.framebufferTexture2D(this.FB,r,this.T2D,e,0)})),this.gl.framebufferRenderbuffer(this.FB,this.DA,this.RB,i),this.gl.drawBuffers(o),this.checkFramebufferStatus()})),r};t.prototype.bindRBO=function(t){this.gl.bindRenderbuffer(this.RB,t)},t.prototype.unbindRBO=function(){this.gl.bindRenderbuffer(this.RB,null)},t.prototype.useRBO=function(t,e){this.bindRBO(t),e(),this.unbindRBO()};t.prototype.createDepthBuffer=function(t,e,i=16){const r=this.gl.createRenderbuffer();return this.useRBO(r,(()=>this.gl.renderbufferStorage(this.RB,24===i?this.gl.DEPTH_COMPONENT24:32===i?this.gl.DEPTH_COMPONENT32F:this.gl.DEPTH_COMPONENT16,t,e))),r};t.prototype.transformFeedback=function(t,e,i,r){this.useVAO(t,(()=>{this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,e),this.gl.enable(this.gl.RASTERIZER_DISCARD),this.gl.beginTransformFeedback(i),r(),this.gl.endTransformFeedback(),this.gl.disable(this.gl.RASTERIZER_DISCARD),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,null)}))};t.prototype.DataType=function(t){return t.constructor.name},t.prototype.Data=function(t,e="f32"){if(Array.isArray(t))return new this.DataMap[e](t.flat(1/0));if("number"==typeof t)return new this.DataMap[e](t);throw new Error("Unsupported data type")};t.prototype.quadData=function(){return this.Data([[-1,-1,0,0],[1,-1,1,0],[1,1,1,1],[1,1,1,1],[-1,1,0,1],[-1,-1,0,0]])},t.prototype.quadBufferInfo=function(t="aPosition",e="aTexCoord"){return{buffer:this.createBuffer(this.quadData(),this.STATIC_DRAW),stride:16,attributes:[{name:t,unit:"f32",size:2},{name:e,unit:"f32",size:2}]}},t.prototype.sketchData=function(){return{positionData:this.Data([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),texCoordData:this.Data([0,0,1,0,1,1,1,1,0,1,0,0])}};t.prototype.CONTAIN="contain",t.prototype.COVER="cover",t.prototype.FILL="fill",t.prototype.NONE="none",t.prototype.SCALE_DOWN="scale_down";const e="padding: 0; margin: 0; border: 0;",i="width: 100%; height: 100%;",r="display: flex; justify-content: center; align-items: center;",o="box-sizing: border-box;",s="position: static;",n={pageCSS:()=>{const t=document.documentElement,o=document.body;t.className="",o.className="",t.style.cssText=e+i,o.style.cssText=e+i+r},containerCSS:(t,e)=>{let i="";e.container.customBoxModel||(i=`\n\t\t\t\tmargin:  ${e.container.margin} ;\n\t\t\t\tpadding: ${e.container.padding};\n\t\t\t\tborder:  ${e.container.border} ;\n\t\t\t`),t.style.cssText=`\n\t\t\tmax-width:  ${e.container.width};\n\t\t\tmax-height: ${e.container.height};\n\t\t\twidth:  ${e.container.width};\n\t\t\theight: ${e.container.height};\n\t\t\t${o+r+i}\n\t\t`},canvasScaleCSS:t=>`\n\t\t\tmax-width:  ${100*t.canvas.scale}%;\n\t\t\tmax-height: ${100*t.canvas.scale}%;\n\t\t`,innerContainerCSS:(t,e)=>{let o=n.canvasScaleCSS(e)+s+r+"overflow: hidden;";"cover"===e.canvas.fit&&(o+=i),t.style.cssText=o},canvasCSS:(t,r)=>{const a=r.canvas.fit;let h=n.canvasScaleCSS(r);["cover","none"].includes(a)&&(h=""),"fill"===a&&(h+=i),t.style.cssText=`\n\t\t\t${s+e+o+h+"display: block;"}\n\t\t`}},a={container:{id:void 0,parent:void 0,width:"100%",height:"100%",margin:"0",padding:"0",border:"0",customBoxModel:!1},canvas:{scale:1,fit:"contain"},stylePage:!0},h=(t,e)=>{const i=(r=a,o=e,{...r,...o,container:{...r.container,...o.container},canvas:{...r.canvas,...o.canvas}});var r,o;const s=i.canvas.fit??"contain",h=i.container.customBoxModel;i.stylePage&&n.pageCSS();const p=i.container.parent??document.body;i.container.parent=p;const c=document.createElement("div"),l=i.container.id??`flex-container-${t.id}`;let u;c.id=i.container.id=l,t.container=c,n.containerCSS(c,i),c.classList.add("flex-container"),p.appendChild(c),["cover","none"].includes(s)&&(u=document.createElement("div"),n.innerContainerCSS(u,i),c.appendChild(u));const g=()=>{const t=h?getComputedStyle(c):c.style,e=e=>parseFloat(t[`padding${e}`]);return[e("Top")+e("Bottom"),e("Left")+e("Right")]};let[f,y]=g(),d="",m="";const E=e=>{"container"===d&&m===e||(m=e,t.style.width="width"===e?"100%":"",t.style.height="height"===e?"100%":"")};["contain","cover"].includes(s)&&new ResizeObserver((()=>{d="container",requestAnimationFrame((()=>{h&&([f,y]=g()),(c.clientWidth-y)/(c.clientHeight-f)>=t.width/t.height?("contain"===s&&E("height"),"cover"===s&&E("width")):("contain"===s&&E("width"),"cover"===s&&E("height"))}))})).observe(c),n.canvasCSS(t,i),["cover","none"].includes(s)?(u.classList.add("flex-canvas"),u.appendChild(t)):(t.classList.add("flex-canvas"),c.appendChild(t))};t.prototype.flex=function(t={}){h(this.ATTACH_TO_2D?this.canvas2D:this.canvas,t)};const p=t=>new Promise(((e,i)=>{const r=new Image;r.addEventListener("load",(()=>e(r))),r.addEventListener("error",(e=>{i(new Error(`Error loading image from ${t}: ${e.message}`))})),r.crossOrigin="anonymous",r.src=t})),c=async()=>{const t=document.createElement("video");try{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e=await navigator.mediaDevices.getUserMedia({video:!0});return t.srcObject=e,t.setAttribute("playsinline",""),t.play(),t}return console.error("Your browser does not support accessing the webcam. Please try using a different browser."),null}catch(t){return console.error("Error accessing stream:",t),null}},l=async t=>{let e;try{const i=await fetch(t);if(!i.ok)throw new Error(`Failed to fetch ${t}`);return e=await i.text(),e=await u(e),e}catch(t){throw console.error(t),t}},u=async t=>{const e=/#include "(.+)"/g,i=[];let r;for(;null!==(r=e.exec(t));)i.push(r[1]);const o=await Promise.all(i.map((async t=>{try{const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch ${t}`);return await e.text()}catch(e){throw console.error(`Failed to load included file: ${t}`),e}})));return i.forEach(((e,i)=>{t=t.replace(`#include "${e}"`,o[i])})),t};var g=(e,i,r)=>new t(e,i,r);export{g as default,l as loadShader,p as loadImage,c as loadWebcam};