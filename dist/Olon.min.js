var t=class{constructor(t=300,e=150,r=!1){this.frame=0,this.seconds=0,this.startTime=0,this.currentTime=performance.now(),this.lastFrameTime=performance.now(),this.fps=60,this.oMouseX=0,this.oMouseY=0,this.mouseX=0,this.mouseY=0,this.bufferList={},this.ATTACH_TO_2D=r,this.canvas2D=null,this.o2D=null,this._initCanvas2D(t,e),this.canvas=null,this.gl=null,this._initCanvas(t,e),this._enableCanvas2D(),this.program=null,this.canvas.addEventListener("mousemove",(t=>this._mouseMove(t,this.canvas))),this.canvas.addEventListener("touchmove",(t=>this._touchMove(t,this.canvas)))}sketch(){const{positionData:t,texCoordData:e}=this.sketchData();this.setAttribute("aPosition",t,"f32",2),this.setAttribute("aTexCoord",e,"f32",2)}fullscreen(){const{left:t,top:e}=this._getBorderSize(this.canvas);this.width=window.innerWidth-2*t,this.height=window.innerHeight-2*e,window.addEventListener("resize",(()=>{const{left:t,top:e}=this._getBorderSize(this.canvas);this.width=window.innerWidth-2*t,this.height=window.innerHeight-2*e}))}_initCanvas(t,e){this.canvas=document.createElement("canvas"),[this.canvas.width,this.canvas.height]=[t,e],this.canvas.id="olon-canvas",document.body.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl2"),this.canvas.style.display="block"}_initCanvas2D(t,e){this.ATTACH_TO_2D&&(this.canvas2D=document.createElement("canvas"),[this.canvas2D.width,this.canvas2D.height]=[t,e],this.canvas2D.id="o2d",document.body.appendChild(this.canvas2D),this.o2D=this.canvas2D.getContext("2d"),this.canvas2D.style.display="none")}_enableCanvas2D(){this.ATTACH_TO_2D&&(this.canvas.style.display="none",this.canvas2D.style.display="block",this.canvas2D.addEventListener("mousemove",(t=>this._mouseMove(t,this.canvas2D))),this.canvas2D.addEventListener("touchmove",(t=>this._touchMove(t,this.canvas2D))))}render(t){const e=r=>{this.frame++,this.timestamp=r,this.currentTime=performance.now(),this.seconds=(this.currentTime-this.startTime)/1e3,this.fps=1e3/(this.currentTime-this.lastFrameTime),t(),this.canvas2D&&this.o2D.drawImage(this.canvas,0,0),this.lastFrameTime=this.currentTime,requestAnimationFrame(e)};this.startTime=performance.now(),requestAnimationFrame(e)}use({program:t=null,VAO:e=null,FBO:r=null,RBO:i=null,texture2D:o=null,buffer:s=null,Depth:n=!1,Blend:a=!1}={program:t,VAO:e,FBO:r,RBO:i,texture2D:o,Depth:n,Blend:a}){return{run:h=>{t&&this.useProgram(t),e&&this.bindVAO(e),r&&this.bindFBO(r),i&&this.bindRBO(i),o&&this.bindTexture2D(o),s&&this.bindBuffer(s),n&&this.enableDepth(),a&&this.enableBlend(),h(),a&&this.disableBlend(),n&&this.disableDepth(),s&&this.unbindBuffer(),o&&this.unbindTexture2D(),i&&this.unbindRBO(),r&&this.unbindFBO(),e&&this.unbindVAO()}}}get oMouse(){return[this.oMouseX,this.oMouseY]}get mouse(){return[this.mouseX,this.mouseY]}get limit(){return{TOTAL_TEXTURES:this.MAX_TEXTURES,FRAG_TEXTURE:this.MAX_FRAG_TEXTURES,VERT_TEXTURE:this.MAX_VERT_TEXTURES,DRAW_BUFFERS:this.MAX_DRAW_BUFFERS}}get MAX_TEXTURES(){return this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)}get MAX_FRAG_TEXTURES(){return this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}get MAX_VERT_TEXTURES(){return this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}get width(){return this.canvas.width}get height(){return this.canvas.height}set width(t){this.canvas2D&&(this.canvas2D.width=t),this.canvas.width=t,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}set height(t){this.canvas2D&&(this.canvas2D.height=t),this.canvas.height=t,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}get resolution(){return[this.canvas.width,this.canvas.height]}};t.prototype.BLEND_MODE=32774,t.prototype.BLEND_SFAC=1,t.prototype.BLEND_DFAC=0,t.prototype.STATIC_DRAW=35044,t.prototype.DYNAMIC_DRAW=35048,t.prototype.STREAM_DRAW=35040,t.prototype.STATIC_READ=35045,t.prototype.DYNAMIC_READ=35049,t.prototype.STREAM_READ=35041,t.prototype.STATIC_COPY=35046,t.prototype.DYNAMIC_COPY=35050,t.prototype.STREAM_COPY=35042,t.prototype.COLOR_BUFF=16384,t.prototype.DEPTH_BUFF=256,t.prototype.STENCIL_BUFF=1024,t.prototype.POINTS=0,t.prototype.LINES=1,t.prototype.LINE_LOOP=2,t.prototype.LINE_STRIP=3,t.prototype.TRIANGLES=4,t.prototype.TRIANGLE_STRIP=5,t.prototype.TRIANGLE_FAN=6,t.prototype.REPEAT=10497,t.prototype.CLAMP=33071,t.prototype.MIRROR=33648,t.prototype.NEAREST=9728,t.prototype.LINEAR=9729,t.prototype.NMN=9984,t.prototype.LMN=9985,t.prototype.NML=9986,t.prototype.LML=9987,t.prototype.FB=36160,t.prototype.T2D=3553,t.prototype.RB=36161,t.prototype.DA=36096,t.prototype.AB=34962,t.prototype.ADD=32774,t.prototype.SUB=32778,t.prototype.REV_SUB=32779,t.prototype.MIN=32775,t.prototype.MAX=32776,t.prototype.ZERO=0,t.prototype.ONE=1,t.prototype.SRC_COLOR=768,t.prototype.ONE_MINUS_SRC_COLOR=769,t.prototype.DST_COLOR=774,t.prototype.ONE_MINUS_DST_COLOR=775,t.prototype.SRC_ALPHA=770,t.prototype.ONE_MINUS_SRC_ALPHA=771,t.prototype.DST_ALPHA=772,t.prototype.ONE_MINUS_DST_ALPHA=773,t.prototype.CONSTANT_COLOR=32769,t.prototype.ONE_MINUS_CONSTANT_COLOR=32770,t.prototype.CONSTANT_ALPHA=32771,t.prototype.ONE_MINUS_CONSTANT_ALPHA=32772,t.prototype.SRC_ALPHA_SATURATE=776,t.prototype.RGB=6407,t.prototype.RGBA=6408,t.prototype.LUMINANCE_ALPHA=6410,t.prototype.LUMINANCE=6409,t.prototype.ALPHA=6406,t.prototype.R8=33321,t.prototype.R16F=33325,t.prototype.R32F=33326,t.prototype.R8UI=33330,t.prototype.RG8=33323,t.prototype.RG16F=33327,t.prototype.RG32F=33328,t.prototype.RG8UI=33336,t.prototype.RGB8=32849,t.prototype.SRGB8=35905,t.prototype.RGB565=36194,t.prototype.R11F_G11F_B10F=35898,t.prototype.RGB9_E5=35901,t.prototype.RGB16F=34843,t.prototype.RGB32F=34837,t.prototype.RGB8UI=36221,t.prototype.RGBA8=32856,t.prototype.SRGB8_ALPHA8=35907,t.prototype.RGB5_A1=32855,t.prototype.RGB10_A2=32857,t.prototype.RGBA4=32854,t.prototype.RGBA16F=34842,t.prototype.RGBA32F=34836,t.prototype.RGBA8UI=36220;t.prototype.UniformMap={5126:(t,e,r)=>t.uniform1f(e,r),35664:(t,e,r)=>t.uniform2fv(e,r),35665:(t,e,r)=>t.uniform3fv(e,r),35666:(t,e,r)=>t.uniform4fv(e,r),5124:(t,e,r)=>t.uniform1i(e,r),35667:(t,e,r)=>t.uniform2iv(e,r),35668:(t,e,r)=>t.uniform3iv(e,r),35669:(t,e,r)=>t.uniform4iv(e,r),35670:(t,e,r)=>t.uniform1i(e,r),35671:(t,e,r)=>t.uniform2iv(e,r),35672:(t,e,r)=>t.uniform3iv(e,r),35673:(t,e,r)=>t.uniform4iv(e,r),35674:(t,e,r)=>t.uniformMatrix2fv(e,!1,r),35675:(t,e,r)=>t.uniformMatrix3fv(e,!1,r),35676:(t,e,r)=>t.uniformMatrix4fv(e,!1,r),5125:(t,e,r)=>t.uniform1u(e,r),36294:(t,e,r)=>t.uniform2uv(e,r),36295:(t,e,r)=>t.uniform3uv(e,r),36296:(t,e,r)=>t.uniform4uv(e,r),35678:(t,e,r)=>t.uniform1i(e,r),35679:(t,e,r)=>t.uniform1i(e,r),35682:(t,e,r)=>t.uniform1i(e,r),36289:(t,e,r)=>t.uniform1i(e,r),36292:(t,e,r)=>t.uniform1i(e,r),36293:(t,e,r)=>t.uniform1i(e,r)},t.prototype.samplerTypes=new Set([35680,35678,35679,35682,36289,36292,36293]),t.prototype.UnitMap={i8:{size:1,type:5120},i16:{size:2,type:5122},i32:{size:4,type:5124},u8:{size:1,type:5121},u16:{size:2,type:5123},u32:{size:4,type:5125},f32:{size:4,type:5126}},t.prototype.TypeArrayUnit={Int8Array:"i8",Int16Array:"i16",Int32Array:"i32",Uint8Array:"u8",Uint16Array:"u16",Uint32Array:"u32",Float32Array:"f32"},t.prototype.DataMap={i8:Int8Array,i16:Int16Array,i32:Int32Array,u8:Uint8Array,u16:Uint16Array,u32:Uint32Array,f32:Float32Array},t.prototype.IFormatMap={6407:{format:6407,type:5121},6408:{format:6408,type:5121},6410:{format:6410,type:5121},6409:{format:6409,type:5121},6406:{format:6406,type:5121},33321:{format:6403,type:5121},33325:{format:6403,type:5126},33326:{format:6403,type:5126},33330:{format:36244,type:5121},33323:{format:33319,type:5121},33327:{format:33319,type:5126},33328:{format:33319,type:5126},33336:{format:33320,type:5121},32849:{format:6407,type:5121},35905:{format:6407,type:5121},36194:{format:6407,type:5121},35898:{format:6407,type:5126},35901:{format:6407,type:5126},34843:{format:6407,type:5126},34837:{format:6407,type:5126},36221:{format:36248,type:5121},32856:{format:6408,type:5121},35907:{format:6408,type:5121},32855:{format:6408,type:5121},32857:{format:6408,type:33640},32854:{format:6408,type:5121},34842:{format:6408,type:5126},34836:{format:6408,type:5126},36220:{format:36249,type:5121}};t.prototype.enableExtensions=function(t){const e=t.filter((t=>!this.gl.getExtension(t)));return 0===e.length||(console.warn("enableFloat: The following extensions are not supported:",e.join(", ")),e)},t.prototype.enableFloat=function(){this.enableExtensions(["EXT_color_buffer_float","OES_texture_float_linear"])};t.prototype._shader=function(t,e,r){const i=this.gl.createShader(r);/#version 300 es/.test(e)||(e=`#version 300 es\n${e}`),e=e.replace(/^\s+/,""),this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.attachShader(t.program,i)},t.prototype._processShader=function(t,e,r){Array.isArray(e)?e.forEach((e=>this._shader(t,e,r))):this._shader(t,e,r)},t.prototype.setShader=function(t,e){this.program=this.createProgram(t,e),this.linkProgram(this.program),this.useProgram(this.program)};t.prototype.setProgram=function(t){this.program=t},t.prototype.linkProgram=function(t){this.setProgram(t),this.gl.linkProgram(t.program)},t.prototype.useProgram=function(t){this.setProgram(t),this.gl.useProgram(t.program)},t.prototype._updateProgramUniforms=function(t,e,r,i){t.uniforms[e]={type:r,size:i}},t.prototype.createProgram=function(t,e,r){const i={program:this.gl.createProgram(),uniforms:{},texUnitList:{},texUnitCount:0,emptyTexUnits:[]};this._processShader(i,t,this.gl.VERTEX_SHADER),this._processShader(i,e,this.gl.FRAGMENT_SHADER),r&&this.gl.transformFeedbackVaryings(i.program,r,this.gl.INTERLEAVED_ATTRIBS),this.linkProgram(i),this.useProgram(i);const o=this._getActiveUniforms(i);for(let t=0;t<o;++t){const{name:e,type:r,size:o}=this._getActiveUniform(i,t);this._updateProgramUniforms(i,e,r,o),this.samplerTypes.has(r)&&this._setTexUnit(e)}return i},t.prototype._setTexUnit=function(t){const e=this.program.emptyTexUnits.length?this.program.emptyTexUnits.pop():this.program.texUnitCount++;this.uniform(t,e),this.program.texUnitList[t]=e},t.prototype._getActiveUniform=function(t,e){const r=this.gl.getActiveUniform(t.program,e);return{name:r.name.replace(/\[[^\]]*\]/g,""),type:r.type,size:r.size}};t.prototype.createBuffer=function(t,e){const r=this.gl.createBuffer();return this.useBuffer(r,(()=>this.gl.bufferData(this.AB,t,e))),r},t.prototype.bindBuffer=function(t){this.gl.bindBuffer(this.AB,t)},t.prototype.unbindBuffer=function(){this.gl.bindBuffer(this.AB,null)},t.prototype.useBuffer=function(t,e){this.bindBuffer(t),e(),this.unbindBuffer()};t.prototype.drawArrays=function(t,e,r){this.gl.drawArrays(t,e,r)},t.prototype.points=function(t,e){this.gl.drawArrays(this.gl.POINTS,t,e)},t.prototype.lines=function(t,e){this.gl.drawArrays(this.gl.LINES,t,e)},t.prototype.lineLoop=function(t,e){this.gl.drawArrays(this.gl.LINE_LOOP,t,e)},t.prototype.lineStrip=function(t,e){this.gl.drawArrays(this.gl.LINE_STRIP,t,e)},t.prototype.triangles=function(t,e){this.gl.drawArrays(this.gl.TRIANGLES,t,e)},t.prototype.triangleStrip=function(t,e){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,t,e)},t.prototype.triangleFan=function(t,e){this.gl.drawArrays(this.gl.TRIANGLE_FAN,t,e)},t.prototype.drawArraysInstanced=function(t,e,r,i){this.gl.drawArraysInstanced(t,e,r,i)},t.prototype.pointsInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.POINTS,t,e,r)},t.prototype.linesInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.LINES,t,e,r)},t.prototype.lineLoopInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.LINE_LOOP,t,e,r)},t.prototype.lineStripInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.LINE_STRIP,t,e,r)},t.prototype.trianglesInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.TRIANGLES,t,e,r)},t.prototype.triangleStripInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.TRIANGLE_STRIP,t,e,r)},t.prototype.triangleFanInstanced=function(t,e,r){this.gl.drawArraysInstanced(this.gl.TRIANGLE_FAN,t,e,r)};t.prototype.aLoc=function(t){return this.gl.getAttribLocation(this.program.program,t)},t.prototype.uLoc=function(t){return this.gl.getUniformLocation(this.program.program,t)},t.prototype.oLoc=function(t){return this.gl.getFragDataLocation(this.program.program,t)};t.prototype.setAttribute=function(t,e,r,i,o){const s=this.aLoc(t),n=this.gl.createBuffer(),a=this.UnitMap[r].type;this.useBuffer(n,(()=>{this.gl.bufferData(this.AB,e,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(s,i,a,!1,0,0),this.gl.enableVertexAttribArray(s),Number.isInteger(o)&&o>=0&&this.gl.vertexAttribDivisor(s,o)}));const h={buffer:n,loc:s,name:t,data:e,size:i};return this.bufferList[t]=h,h};t.prototype._getActiveUniforms=function(t){return this.gl.getProgramParameter(t.program,this.gl.ACTIVE_UNIFORMS)},t.prototype.uniform=function(t,e){const r=this.program.uniforms[t];if(!r)return;if(Object.hasOwn(this.program.texUnitList,t))return this.gl.activeTexture(this.gl.TEXTURE0+this.program.texUnitList[t]),void this.gl.bindTexture(this.T2D,e);const i=this.uLoc(t);this.UniformMap[r.type](this.gl,i,e)},t.prototype.initUniform=function(t){const e={},r=Object.entries(t);for(const[t,i]of r)e[t]=e=>this.uniform(i,t,e);return e};t.prototype._getBorderSize=function(t){const e=window.getComputedStyle(t);return{top:parseFloat(e.borderTopWidth)||0,left:parseFloat(e.borderLeftWidth)||0}},t.prototype._updateMouse=function(t,e,r){this.oMouseX=e/t.scrollWidth,this.oMouseY=r/t.scrollHeight,this.oMouseY=t.height-this.oMouseY,this.mouseX=this.oMouseX/this.width*2-1,this.mouseY=this.oMouseY/this.height*2-1},t.prototype._mouseMove=function(t,e){const r=t.offsetX*e.width,i=t.offsetY*e.height;this._updateMouse(e,r,i)},t.prototype._touchMove=function(t,e){t=t.touches?t.touches[0]:t.changedTouches?.[0];const r=e.getBoundingClientRect(),{left:i,top:o}=this._getBorderSize(e),s=(t.clientX-r.left-i)*e.width,n=(t.clientY-r.top-o)*e.height;this._updateMouse(e,s,n)};t.prototype.enableBlend=function(){this.gl.enable(this.gl.BLEND)},t.prototype.disableBlend=function(){this.gl.disable(this.gl.BLEND)},t.prototype.blend=function({sfactor:t=this.BLEND_SFAC,dfactor:e=this.BLEND_DFAC,mode:r=this.BLEND_MODE}={sfactor:t,dfactor:e,mode:r}){this.BLEND_SFAC=t,this.BLEND_DFAC=e,this.BLEND_MODE=r,this.gl.blendEquation(this.BLEND_MODE),this.gl.blendFunc(this.BLEND_SFAC,this.BLEND_DFAC)};t.prototype.enableDepth=function(){this.gl.enable(this.gl.DEPTH_TEST)},t.prototype.disableDepth=function(){this.gl.disable(this.gl.DEPTH_TEST)},t.prototype.useDepth=function(t){this.gl.enable(this.gl.DEPTH_TEST),t(),this.gl.disable(this.gl.DEPTH_TEST)};t.prototype.clear=function(t){this.gl.clear(t)},t.prototype.clearColor=function(t,e,r,i){0!==arguments.length&&this.gl.clearColor(t,e,r,i),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},t.prototype.clearDepth=function(t){0!==arguments.length&&this.gl.clearDepth(t),this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},t.prototype.clearStencil=function(t){0!==arguments.length&&this.gl.clearStencil(t),this.gl.clear(this.gl.STENCIL_BUFFER_BIT)};t.prototype._isDOMElement=function(t){return t instanceof HTMLElement},t.prototype.setTexParameter=function(t,e,r,i){this.gl.texParameteri(this.T2D,this.gl.TEXTURE_WRAP_S,t),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_WRAP_T,e),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_MIN_FILTER,r),this.gl.texParameteri(this.T2D,this.gl.TEXTURE_MAG_FILTER,i)},t.prototype.bindTexture2D=function(t){this.gl.bindTexture(this.T2D,t)},t.prototype.unbindTexture2D=function(){this.gl.bindTexture(this.T2D,null)},t.prototype.useTexture2D=function(t,e){this.bindTexture2D(t),e(),this.unbindTexture2D()},t.prototype._emptyTexStorage2D=function({width:t=this.width,height:e=this.height,iformat:r,minFilter:i=this.LINEAR,magFilter:o=this.LINEAR,filter:s,wrapS:n=this.REPEAT,wrapT:a=this.REPEAT,wrap:h,flipY:p=!1}={}){if(!r)throw"_emptyTexStorage2D: Please specify iformat (internalformat).";s&&([i,o]=[s,s]),h&&([n,a]=[h,h]);const u=this.gl.createTexture();return this.useTexture2D(u,(()=>{this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,p),this.setTexParameter(n,a,i,o),this.gl.texStorage2D(this.T2D,1,r,t,e)})),u},t.prototype._emptyTexImage2D=function({width:t=this.width,height:e=this.height,iformat:r,minFilter:i=this.LINEAR,magFilter:o=this.LINEAR,filter:s,wrapS:n=this.REPEAT,wrapT:a=this.REPEAT,wrap:h,flipY:p=!1}={}){if(!r)throw"_emptyTexImage2D: Please specify iformat (internalformat).";s&&([i,o]=[s,s]),h&&([n,a]=[h,h]);const{format:u,type:l}=this.IFormatMap[r],c=this.gl.createTexture();return this.useTexture2D(c,(()=>{this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,p),this.setTexParameter(n,a,i,o),this.gl.texImage2D(this.T2D,0,r,t,e,0,u,l,null)})),c},t.prototype.texture2D=function({data:t=null,iformat:e,level:r=0,width:i=t?.width||this.width,height:o=t?.height||this.height,minFilter:s=this.LINEAR,magFilter:n=this.LINEAR,filter:a,wrapS:h=this.REPEAT,wrapT:p=this.REPEAT,wrap:u,flipY:l=this._isDOMElement(t),immutableStorage:c=!1}={}){if(!e)throw"texture2D: Please specify iformat (internalformat).";if(!t){const t={width:i,height:o,iformat:e,minFilter:s,magFilter:n,filter:a,wrapS:h,wrapT:p,wrap:u,flipY:l};return c?this._emptyTexStorage2D(t):this._emptyTexImage2D(t)}a&&([s,n]=[a,a]),u&&([h,p]=[u,u]);const{format:f,type:g}=this.IFormatMap[e],y=this.gl.createTexture();return this.gl.bindTexture(this.T2D,y),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,l),this.gl.texImage2D(this.T2D,r,e,i,o,0,f,g,t),this.gl.generateMipmap(this.T2D),this.setTexParameter(h,p,s,n),this.gl.bindTexture(this.T2D,null),y};t.prototype._calcStride=function(t){return t.reduce(((t,{unit:e,size:r})=>t+r*this.UnitMap[e].size),0)},t.prototype._vaoByBufferInfos=function(t,e){Array.isArray(e)||(e=[e]);const r=this.gl.createVertexArray();return this.use({program:this.useProgram(t),VAO:r}).run((()=>{e.forEach((t=>{this.useBuffer(t.buffer,(()=>{const e=t.attributes,r=t.stride||this._calcStride(e),i=t.divisor;let o=0;e.forEach((({name:t,unit:e,size:s})=>{const n=this.aLoc(t),a=this.UnitMap[e].type;this.gl.vertexAttribPointer(n,s,a,!1,r,o),this.gl.enableVertexAttribArray(n),o+=s*this.UnitMap[e].size,Number.isInteger(i)&&i>=0&&this.gl.vertexAttribDivisor(n,i)}))}))}))})),r},t.prototype._vaoByAttribute=function(t,e){this.useProgram(t);const r=this.gl.createVertexArray();return this.useVAO(r,(()=>{e.forEach((({name:t,data:e,size:r})=>{const i=this.TypeArrayUnit[e.constructor.name];this.setAttribute(t,e,i,r)}))})),r},t.prototype._checkUseAttribute=function(t){return Array.isArray(t)&&Object.hasOwn(t[0],"name")},t.prototype.createVAO=function(t,e){return this._checkUseAttribute(e)?this._vaoByAttribute(t,e):this._vaoByBufferInfos(t,e)},t.prototype.bindVAO=function(t){this.gl.bindVertexArray(t)},t.prototype.unbindVAO=function(){this.gl.bindVertexArray(null)},t.prototype.useVAO=function(t,e){this.bindVAO(t),e(),this.unbindVAO()};t.prototype.bindFBO=function(t){this.gl.bindFramebuffer(this.FB,t)},t.prototype.unbindFBO=function(){this.gl.bindFramebuffer(this.FB,null)},t.prototype.useFBO=function(t,e){this.bindFBO(t),e(),this.unbindFBO()},t.prototype.checkFramebufferStatus=function(){switch(this.gl.checkFramebufferStatus(this.FB)){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case this.gl.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"FRAMEBUFFER INCOMPLETE: FRAMEBUFFER_UNSUPPORTED"}},t.prototype.createFBO=function({program:t,outs:e,depthBuffer:r}){const i=this.gl.createFramebuffer();return this.useFBO(i,(()=>{const i=this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS),o=Array.from({length:i},(()=>this.gl.NONE));this.setProgram(t),e.forEach((({name:t,texture:e})=>{const r=this.oLoc(t),i=this.gl.COLOR_ATTACHMENT0+r;o[r]=i,this.gl.framebufferTexture2D(this.FB,i,this.T2D,e,0)})),this.gl.framebufferRenderbuffer(this.FB,this.DA,this.RB,r),this.gl.drawBuffers(o),this.checkFramebufferStatus()})),i};t.prototype.bindRBO=function(t){this.gl.bindRenderbuffer(this.RB,t)},t.prototype.unbindRBO=function(){this.gl.bindRenderbuffer(this.RB,null)},t.prototype.useRBO=function(t,e){this.bindRBO(t),e(),this.unbindRBO()};t.prototype.createDepthBuffer=function(t,e,r=16){const i=this.gl.createRenderbuffer();return this.useRBO(i,(()=>this.gl.renderbufferStorage(this.RB,24===r?this.gl.DEPTH_COMPONENT24:32===r?this.gl.DEPTH_COMPONENT32F:this.gl.DEPTH_COMPONENT16,t,e))),i};t.prototype.transformFeedback=function(t,e,r,i){this.useVAO(t,(()=>{this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,e),this.gl.enable(this.gl.RASTERIZER_DISCARD),this.gl.beginTransformFeedback(r),i(),this.gl.endTransformFeedback(),this.gl.disable(this.gl.RASTERIZER_DISCARD),this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,0,null)}))};t.prototype.DataType=function(t){return t.constructor.name},t.prototype.Data=function(t,e="f32"){if(Array.isArray(t))return new this.DataMap[e](t.flat(1/0));if("number"==typeof t)return new this.DataMap[e](t);throw new Error("Unsupported data type")};t.prototype.quadData=function(){return this.Data([[-1,-1,0,0],[1,-1,1,0],[1,1,1,1],[1,1,1,1],[-1,1,0,1],[-1,-1,0,0]])},t.prototype.sketchData=function(){return{positionData:this.Data([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),texCoordData:this.Data([0,0,1,0,1,1,1,1,0,1,0,0])}};const e=t=>new Promise(((e,r)=>{const i=new Image;i.addEventListener("load",(()=>e(i))),i.addEventListener("error",(e=>{r(new Error(`Error loading image from ${t}: ${e.message}`))})),i.crossOrigin="anonymous",i.src=t})),r=async t=>{let e;try{const r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch ${t}`);return e=await r.text(),e=await i(e),e}catch(t){throw console.error(t),t}},i=async t=>{const e=/#include "(.+)"/g,r=[];let i;for(;null!==(i=e.exec(t));)r.push(i[1]);const o=await Promise.all(r.map((async t=>{try{const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch ${t}`);return await e.text()}catch(e){throw console.error(`Failed to load included file: ${t}`),e}})));return r.forEach(((e,r)=>{t=t.replace(`#include "${e}"`,o[r])})),t};var o=(e,r,i)=>new t(e,r,i);export{o as default,r as loadShader,e as loadImage};